language: node_js
node_js:
- "0.10.36"
install:
- npm install
before_script:
  - chmod +x deploy.sh
script:
  - npm test
sudo: false
deploy:
- provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch: dev
- provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch: release
- provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch: master

env:
  matrix:
    - CXX=g++-4.8
  global:
    # DEV_MEMBER_ES_HOST
    - secure: O2QKv11yrnSqy9H3UC/XIAP6qARl6WMNY6ezzCvQ7EExRgVGeT1GTy16M8V14j43NV4CDzEDVjrdO/TPZbpWB4EN83aAU2XfDyqPNRTP+34trVUssfuVCwYpASyX0JlecQFXJA/SCbEOWTCPvohE5AoRub0Jf/PNAozBmXnSBJmFNh67cu0HHYeg4lBM4moa3wp9ia2CUEsAOq5P2KMwBmwrfJtbfCAc121QoYgyflL0gvLzWi3TgfvOjY2JxymZAnoSXRr9NukwrsqSc2a13ZBmGFqxpRD9Kt7wL6A0hbHKyfkmRq2+ExmumFIDO/5lylIw9a1x2b0vChs+CrXwo/BL2oNVTvXXspGiiZxDc052tV3QWEUWCsvrljnZosarNGd/59X8f6OgquHhblQ1NZjmeWlZV2X2W1QzAnTzm3M0Fwo1t+INIh2zyZniI730/29rV0djs0EiOBl0NyKbgOKfAKflPAZcuU3jP7YDZwQdXgmaBexCpc5NqTF1n4f3P9QEixa5OuDh9p9P3/2awFjbyfaBtVfJnk3jckZWEunLkulDRqZM6Zz2ym9HyU5xTtelERorzTSgi0e25Had+WdYf0CiIeQT/cR3CR8B1neD2hwidm3tntrb54EvnutiqY2wlZPWvQdEhkxptQLopdkHGu+9/J5HJwOq18fO/EM=

    # DEV_AWS_KEY
    - secure: aGNnOjVW8W5/cFGhMMZqW6TSNcPrHjRD5WDPAwq4bi4MgvxXv3wyMxedjnWImT+HRx8rj6IiP0ZqGxtoXS9T4EgOzV6WfmzF70HMXQi/+3qLDFRP4gJHmnrYQ0AKwel64OmTumbGPF6mexFgKnCfqvfYKMZ60pMbSBPUCsTCJ3v7xFn03NyF70b+APOUNtopNAp+1BVGdq5r0hCBzaNqPwCCQ3IOxYxyDwp6vZyPdJuEXMaOhEE9bqOADa618O481WtzQ9/Uc0PEJ3PFOxPdIVNmF9+FxvnTwFAivO0DIkYUjl6T7tt8EVyWcwwTmFpyYAURNHjQMjFJatBs5pC/knBhjVwjnE0WUZySrnYftXqAMUd+B1T9qml5QmtA4ATyO9N32tdBriwNoK/Ch2FkCUE6azeeTOMjbpq5sIfhF4iCft6jpfp/sLtAfG05X4nhx4UF2I4TE/u+ZR2bTJVYWtOYB8nVnRwM3zJvnGd9fS7uNyxxkd71a3V0JrzniPBrjgbhd2OPhS4U3zT6IRrlEn//Quy6u/KE86ygqjZIq+2xjrzaOMfcP5J8gHXsM5CStGIZTkk0sdqVzH+YFPj8MejgAfailWWPRkDLBwt1AD2cGaXj7k8Y4DMWaednVpkfsFyQ9KC9+KKGCrWI2SlmOn0JDB7DWqEkfr8RpR/izy8=
    # DEV_AWS_SECRET
    - secure: mjYzQJQF04TScyN8wBg3NisVJwuefOAwFj5TQAFEMj+5SYh7dERx8CMS51m6QWPq9D1hMi5gYl1hJcHdrhj5E0jZRx6HF2eWlSCQGiWl18youHEx4xmZe/lfYHq6pP57ys2CHaMNBrTlwQOVnJjY68VGtfD2dwVbkMYofM00MmU8ZQafJZNVi6yxAepFJevunYcaLxFJH2/C4bDcQv7WXQfHHFXLMzomTBYtHiduvKy1gVueyb8fG2ul0H6+UdL1juDtfs8dKvTflnYpf04pCNA0Aj6xcsGKaLeU6/a5J5EWcT4VV66rf1df0WexxrSMIUIcll2H8x22t+z3jEBJ+BBvJ7W1ojYLN7MnTy4tvDWqDokeyRjyBg1af8wyn9WmL/JrTMxsomuN6YeqUmUn8D0115gpJl831P5kQLWGZnPVhd1C7gEOkGWn6+P0Verx8j3F60Mr5xgqwPdBL1L+IjLog0w+f7KB8KQ3tJ94+hEpxNveV0Wn5M256meajyeY1k9YmCWI2DbSojRae8gwiU7/mDGwMHjoPaYRttXD7t3095dFClUafzQA6izyk6Uhz+SbCbpqs94RzMl2ny3y0siNDKTw28p5Vg35CUU+kib3JkzxQQ9HkKeqX0ufBJhGl9EAsR9KAiOuoGXH93tG46UIwaXIrj4gQtixl8P0jNM=
    # DEV_AWS_LAMBDA_ROLE_ARN
    - secure: R8KfL51csAq/vwJBFAZT5FMql7z00HHUwfY6m5dEOTcVQDOiAFawVF1q3x5HpotXQLF21tgUvgU7kvvDtN86DyZMxg62w0x8VVar3zmxQJUalUWXeHE9wbrb45Gk6F8D7AWIGzJFgP0TQjpv/jiOJ9kH+PDXhwYe43ngz8J+7wK0uZT8byn74BYqqrz5gybSFA+iM1+TKmDOyJk2sBOcX5xWsTGgjM1BbVpom9c1HxxmAvt/OaMOhgsPJO2Wv61BwrnIW6IygfHbDDzl0M3ohW191Pt4UmhkVDb3pO6NqaLRgYRWCeZXroQCJzfjIj0ITBSbcoYUGnqPLSccDaIPXsSA4ytBQe1K6D9urb8ZvMXVoWJOaAWFqEIH2/4p0w8hfF8l+G4Lodk//rh2x6FNjFDXpMEpmBp1q85Uk55u/D84lm+Wgn6EXA+pg3BTxEPdSMhUK9URNj3cJ10oNwkCA9mZII2Xis4CprwLjJ7eouVs3gy5AHCInD/wdGQg2J4JoBFp5vKlfLk7joBxLaKmDHI/qXav7dxpINStvJKbvUkCc+PYnxrAZG3xy5rnLWiTwb9I8cF6Dfrw+huCXRxONzDsep7MBNG8r5MJilE/g8cAzjkNDZStZP4VP5VD1Jv5saVVVAQCuLRWbJnVW4e7Ywxy9uCRociFzhPjFSFwONQ=

    # QA_MEMBER_ES_HOST
    - secure: DcEKCZVh7OImVSMOyu7utz+/EIwFZ7emOsyda0F9OYMx1gIBV7ate6MRDSTcKdmw/nSnSW/flq/JBtiReLTmyCitRgJPFDZdsM6XlhNEX9xT1kK/1PwmgKIUh3PgX1s164UXd1D9OAqvvDyDVPmVUerQuPHb4reZ0rdoEC06bsIDla9HjgZr0CltVlDZDcVua1pFpd5l+iAPJXjbQguWLCnjcil/0OrP2+TIIarFRDENMxndWg9a/LS40PkmwHQ32VMsZH4CCMFW+Yuq0UjqdBOy2F4+0qYp3zn/z40TLiPuB0CoEWfx89X9nRoq3WrV41o6sNOsr3W30AWzSJO0igzhPgdZCWv7XFb+wRJYpWuHstTrTvEH1gYrX1K+GeseTp9Waq5cavOTVQuU42UwUvC4kveJ72tOemnO2Qic4Aq0JlNKWqUTfZRSlXYmwAxlmw/KLF0Tq4KIrVgmFqhxBWC1Lx+gZVJMTWYEp5t7Jwe+GW9SAFVJMI6zfti+xZKnSg09HUHcuO4ZkrnA2d+5hoTndau5yzAnc6ir9uLgFIuPaJ6EJDT0UyY+eYdJlDht6D4l0wfvLjJdkKf3nA6yB73r1V97a78WHFXHW3eGCGj8T88c5SPgED3Ovck3/uM3NVrpM2PrLxsH7RqhxzdrFmTITipM1DkwPIhWPGTSOAU=

    # QA_AWS_KEY
    - secure: fi5m2CWmm73sji1jJZRgMy4SFUAG510hnW2ouEF71beAbjhTAo+dyim+LDhCGaMF2H5x7uFQlQHCjOomZYYebcCEMbVynx8FHjidVMuHfTZuj9oq1r05xaJe7As5r3DQDibL98cLL0rIwB94wQxMYu2cHe78W5Ehjmbj++4mt4eKjGcl1Ej+W7K2dS+qDjgaomp7GHkVoN5dnpe502MXqPTqnpr4oFg85uOFBrHpIPEf1a5Li2hkUMCTS3FRg5DGXvSD4haVobB2Mr9grluuGy5o9fZ7gBJ8c+zBRTtWy1Z67SISxlfwx6A4LabLyG5i7ddN0+ujNu5E5uH+Cf7dRUs/LpnU2DFDbe5X9D6dAX4f2B7PiBMOO+5Cuh//sUQAPka99DpixYNXc2ozt4X0yQ2GiypkpICqQHcazbdTsiQESY8Uk+0DRonGCM2dGyFFvFw/p7nFkvIGFJljZCLZNhse9EEUUWTHu/vnuZT4+QpoVdh9p39HWApw+C/fbfkCfL6wtCYmJWJgikLK+XEyHx4ay3YODD18g+m7SnRj/JLfGWyl/5Mu56OapZNAChF9HP9zRYtQa63e3tWf7/JKbLS22zqBNJfPhZ1znoSTROfqwB2pzubcdTCaeoTpc+TDLBVJab7Yl8cuKKtLYuzQJqBjeQls966992nwqTQ0uzc=
    # QA_AWS_SECRET
    - secure: mx2ZweIBT8ZwmdtDLJXSUunppimd7jdDRQqZBQp1D4pxtjxBzoBHf8IlwvkxblsH3UIcyn4ns8LQfYnYIGngN8PsjGzXC6uhznwWmRfwQQgmDKC8ZSYCprLpGMfAE66wrLG+NUvgW42hgKSYXnqx7lYok1e17IFwv6TWvmvhfVG9mJ8wYpsRS1GDzO47jzPDeHW4ApFSZHsV0zX98J6ML7Zte3MvmBMcBRkdlLn30HlRQo2M+NPqlJTOSEgfIWp34D6ZDKcN5tXF8n5PG9x5lXuC46jXGP/S+ZActqoPpLDiHUwu5kVDGYxpODiIQ9B1tWU0VBIMMulzOOuZoR00etGxwyENTA0UkFzXvAu7kxNBbO13y3T/Rvnyf9TGUpt5KhuswI6yZv3a+RX6ZRkYs63mxZrMQcZGeBCOhQqRgnEZ6i67s4pnhaRNqvI3lsVpnzaoxNgeb6YZcRgkp4X+pYBjfhG2jxx7Adq/mOmjDQqiqHHNcU9TLb1A4dLLt1MnRg1Me/QNpEmBMnzaUbdGI2vIWgoDdYsit/Oill5rLXYMn1ZjS9WId0uMv98Bb2RI37k2O+MwV9AoDqPc4hP3cWQBiE5f8lacbFZNQhVvwCxjaZuaGQeBcFRhdsYcfxIO7oEssoFSMjNHQquk7v356t9glf7rsZV2KL9KT1BhLyQ=

    # QA_AWS_LAMBDA_ROLE_ARN
    - secure: VR+/ffd1IkvSnp7Da6t8C1u6Q84r+p7tOXWgtgHc08pb43whTFhmzs1tCIUHwNzy6UZ/u8mCjZO43r/8brfg+wVBE1ci98gWUS8ELz4Khz71M9WFQq1GwiJNYz6fmGl2Iq0puvraVCY6noxtgkwo/S/sb5xHWCR3+karbronYDuyHJpoDRILkZwPsp6Ep4x+QMZk5l8rZ7anJ63evnQW7VyrXcdBZhkcvESXbfXdh9Gg88wZg1Oq+Na743ldJphfR5UEfQtnwXj9EASWE1kvdZMzhfg5hfwNxS1iD97+SAzRHRY+RqCxShKj31rSHbaB7J/qrj6gpSBSUIKbLcP4QnIVCJ/B0RdcDzNUwXISJXK4ddyLPVyrP2eqq4bdWHMCEJq9IT2v2bbprvRkGBQhtqFbPiEuiBMuy9YUuVNSLhbe9JO080nkh0ftQAl7CUlQpSNOCDHygPDzG1sKv0fIN8y7f2DFEFA+CsZVINUjlgoYXZcKbqyz6updAjXfOhg9hPa3W1TXNq+UYNlDk1Mcop8/cYTNNaJGhdj4OEew+r5WITfHZtPxsampQ1N1urkrHt3ylxc86CTn3SoM/n3T0arw919wSXbSpizMBVaCG/KBDk8TdaVDdJ/YfSJKe08zX8p/Oty4oXRlVzsDEX5gsipUC6IRENgZxMlSqFd6oc0=
    
    # PROD_MEMBER_ES_HOST
    - secure: DsSIrcp0zI6CadrOWDFOWk14m2Uh+LaXfydx6tWXe9Yw9jRkedjIuCd6ehvnEmNMdPrZ4Rvgo64cx5ZG2GkbeYobV/3K4FkVeLPngcv3EtCGGBmA8SNorvAW49WTrXAY1brGnlQ8Q8p+10XCPINaAgVnLxPyIaj+stscUM4DEJBMtaCdiKVUzdz5THSg2l1t88pY8G2ViE2pEC0//2Z4IP2oYnXEt/wUcr/vcxird7oXKit00EzkdhVTLUOYt7/tchpJADJEHEho7CPQLT8kkRAgKFAlvU+B/pCImlo2VKA/FpyM4fbfUveBuJtwWOoIVOajFKVcn+nuCHHaEX5tOSn24cZqRTA59FV6dQwHW6x8iHX9BNu76W0XiVlp4xvMYjYtkQUssca1K4PIsPfWBrNqi+XE8RieX8S9vefu60F8iNh6VGfdot8+bW6y0KTuryR16hF5Jwu1koumdRqDSoW36oXPfhHGIWnTRlys1v7iZEgmKf95oDkcpMdl8SMNt6VH0VpiJFfD2xD6Q+NcMvbPtqo7WBdM4V0wp7GADrgGC5miGB7A79DvR2HOMUy/Mj5hFu8XVddkI6KQ3wuhfeqz23bxyn95MXFEYo4yq48VZAY1e7ono/Cym7QAgwKFT4xSBR/Z+fRG6foSDhNBpIAeE2zW+26BFjwUwxhXClk=

    # PROD_AWS_KEY
    - secure: Uxu77YRVgGDgy38Hhw9H6yYC3m3jmrcqnfOUyn7h9MX/MVsj9o8yJN8NmWUCNTqwfhri6ao75l7MNpBTLNflkPGQ9Y2dOjOt6xam7fFo90GbjfWfovyHtHD+Lk1eOMlr+/HlqBoyXiBBDOYbSaGOvjHQx5EqYqIB8K7LY0Oj4Qic7MgJ181jEtukBEq4E70PdVL1GQV6KlPUS4/ZWs64ov4++2Wd2/Z1M6v3PBwyDM1FjcjmA+0qcfhf+DNFE3quXtOrIIWPxkFRy3TtqUyxe0ikDc6bMFXXUbh7dNQi5Az1sOrFadl6rq+7wRLusSIhKAF4vckLi3Bd4RszAz/fu5TJ933CtsQKaFyE7jhTgr/i7RUmueBOhZaRTeIhO6653KxrsRXspVGK5OWgJFkaUn6Hi+e3S++JlTSbqdITtGnyKsbs+D5RHX+YUrbZhUUBGtBnWGtMA3Plwe0hDKHg9wRy0MiXH+tKw/Fgpj+dxcp7t7Jm1deq+3AJrCFnDyGaBp2xcAIJltAlhjV4lPhgdoDaXQafkGR+uedDKLQAr6wgY0mRUmVKO71ER3ld78Xic4k05/vmhw7RAs4GmK/2wFY2IXGPmQfSY9TmxOZLpGcGV45QIagcr7jeQblTkjJEuUsw7W82nWWduzCvHdQsPS6C+fHgxUpwcx55u+opLHY=

    # PROD_AWS_SECRET
    - secure: hFppMmncaYS2hZ9AtTzJUD0mQFSBGh8m/onzHYIILR5VkaVL6aa2++Lpnn5QdASKy04cXtpmZL393XWfWqGwfIPZcGcjlZ2viUL/gFI+jpHRKxp6TSvfIiQ3G8b9tZNA36I1fpmmjILOw4q0thoJp1ThtoPob4KqP4qIXdtdpUTZG53VVCc2jDyeIDm9ThKe/NIWX+5uohRS/TgIJKPYASFhVw8MfsoSAy4pJoO4m5zl7eihNUEZVSPVZRMjIkVgEQRFRTd2fnT5KrK7K3ksEvPCO1JLYlCDEdoC62gH+O7e0ibgRTxajkUYwEHS4lgryzkVPXd3h++FoFyKYjXwlgWzbhW/DXgqgK+Zx45vpJEGwZuGEM6b6h34Rg+araekvmDVC6ti2ZWY26/3O5p0+yJuNnT8kX8L2XFCbmDsWThCWcHhP0PcjlL64gKAiV0Ke08CtzGVc8ID94I2sjxDpY6/MGSiPWvdUlykE7v9rnvgZ915RBjPF6r5/sc7BzHi7uKECCIhvJv1wSazWIQmMLW9X4IdfwPaK2QJk7VPDxQrnK29tIygGQD3mbrTwss0YDeljNfXeon7FaIyP7wSot8Zg0ToicpYe2c3FQcDoKkRe/En1Oue8Bxn/JOAM9fngEuhPKAHKIhPCU3529OR44JLfrPZ5AQXW5grFw06A2g=

    # PROD_AWS_LAMBDA_ROLE_ARN
    - secure: X7YdTpFXYx2nVrga5OTkQaXZRwG3kDmIzP2/agOqkGsQSXWCaAtVZR8Nbz9irfgQ+xGE5p8iRmIU//6S0Um3JQwyz5WAc2TWE+w2iuONg4T8KJr54TeQOaXrjcrj0aHGIvqtdxKHsjzljz0DQepCw4LzC2Mj30YTlsD/6p5jcXy5rDPFw9geAN40/KDZE+m+2j4qF7+VhhMoLOi0raoD9rQ6WT50RtZjLOXNUy9Boc46g91cmhcphF5Wg3Hso3sM1jmtMOxTbWmxjLDjOyGMytqPxy8TMZHoniMqmotGprIW/4/GZC8adGnx9AzQhQmNxIENIxvveFYEM2/0OAtUT59Qrvgc39KjqRieo9IXFxr3DTI3L3sJDH0g4Bw5klZKYvaj0WVM8Az9sTc4BWn9QdF0pOwGWgDGod7cXe3bz3syNX+m6M0KpXyfxvwzyqzAPANfXUhMJQMxTGVSowBNUn1LxMkKPa7zsBhL2IcJnS4h6jtahHHqSN/xUsI91pGMLBikl/HquwwM9FkddXQp47O/bCyVHp5zGC4hV689l5+owjZ5tdPv3PsDAW8K9ayR4vg4jUQCPKT3XNNy5tolKEPwWPWIzelSH1NwaXZlLUs6ZODRymELvwTkwHL9XM5lvs562vozJXACt6vCaLBvlwelmLe0Z1qsjQNsuHXPZ/E=

    # PROD_MEMBER_ES_HOST
    - secure: F+NZsLl5QhT2lApIpgdOCWjiASg9qp6kRhDyzY3v2BRMzH7DrrBEYOXE9KtnA6uz3+RO66SGXV7HvIcANpdzFlRVo2LV0OMMsP4RlXZlvnYTIkhAb9og+/h/pqDWbqvLnmuSkP6vY3K/LjmVq5NhXemdXMLgUQ7zUuosGBdAzIW3mgttICvorYhZF/ZnlaKyCJQ+q49MUIb85aVu+7GDr+ttMiliSv3Nwj4OP8+MBRfJU156tpoE+mfHkLyFlnheDvei20F/fQUJHU+x4hO4h5GsI9Azo9xVKYaoVKsHUJjvbKu2JfAoRd5F5WL0vhFZMUP9pJ747rFSRVZIZEBP8Op2nxqVZdLWOqvdzgo5loXqLwGAOm/1Mgs66IpnnnN2sBD29JGeX/oT+uqNCXAqiwjXFf9yM44f0wQUpFY2oqS8RquJd+1oyO3176JpmmAFVjRhcAADLZnmCg+0LGTqCGv6d9Kbkk+npuBsmmZiVzxm1LBAmtivZu/PumUFMxuCG0JlowTHfzC1l94zX6e4X7uevVMZhZO+OaBEny0vy9eg8EdQUypzuKTFfcwzECHEcdWJeOfbbePs8nSoNrlzghKJKzCbY9cdeQwxSGKqK5tCtHmfyHeoY2sdUzo4xBxoajLhhUHmekL/Uul5wH5I8oF9+vFhMuJTe2Zn95Aaq8A=